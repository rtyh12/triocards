<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">

    <!-- google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lora:wght@700&family=Merriweather&family=Source+Code+Pro:wght@300&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

    <title>Document</title>
</head>

<body>
    <!-- TODO move scripts into head and use async/defer -->
    <script src="https://cdn.socket.io/4.4.0/socket.io.min.js"
        integrity="sha384-1fOn6VtTq3PWwfsOrk45LnYcGosJwzMHv+Xh/Jx5303FVOXzEnw0EpLv30mtjmlj" crossorigin="anonymous">
        </script>

    <div id='room-container'>
        <input type="text" id="name" name="name" placeholder="Enter your name" oninput="onNameInput()">
        <br>
        <br>
        <div id='roomcode-container'>
            <input type="text" id="roomcode" maxlength="4" name="roomcode" placeholder="Room code"
                oninput="onRoomcodeInput()">
            <a onclick="play();" id="play-button">
                PLAY
                <!-- <span class="material-icons-outlined" id='play-circle'>play_circle</span> -->
            </a>
        </div>
        <br>
        Or <a href="#" onclick="requestRoom();" id="requestRoom">create a new room</a>
    </div>
    </div>

    <script>
        var socket = io();

        function play() {
            var roomcode = document.getElementById('roomcode').value;
            window.location.href = "triogame.html" + "?" + "roomcode=" + roomcode;
        }

        function requestRoom() {
            this.socket.emit('requestRoom', undefined, (response) => {
                console.log(response);
                if (response['success']) {
                    var roomcode = document.getElementById('roomcode');
                    roomcode.value = response['roomCode'];
                    onRoomcodeInput();
                }
            });
        }

        function setPlayButtonActive(active) {
            var playButton = document.getElementById('play-button');

            if (active == true) {
                playButton.style.opacity = 1;
                playButton.style.pointerEvents = "auto";
                playButton.style.cursor = "pointer";
            }
            else {
                playButton.style.opacity = 0.5;
                playButton.style.pointerEvents = "none";
            }
        }

        function onRoomcodeInput() {
            var roomcode = document.getElementById('roomcode').value;
            var playButton = document.getElementById('play-button');

            setPlayButtonActive(false);

            if (roomcode.length == 4) {
                this.socket.emit('isRoomcodeValid', roomcode, (response) => {
                    setPlayButtonActive(response);
                });
            }
        }

        socket.on("connect", (msg) => {
            console.log('Connected to server');
        });

    </script>
</body>

</html>
